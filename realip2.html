<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>IP Address Detector</title>
</head>
<body>
    <h3>Your Proxy IP is: <div id="1"></div></h3>
    <h3>Your Real IP is: <div id="2"></div></h3>

    <script>
        // WebRTC configuration using STUN server
        const config = {
            iceServers: [{
                urls: "stun:stun.l.google.com:19302" // Using Google's STUN server, replace with other STUN servers if needed (e.g., stun.voippro.com)
            }]
        };

        // Create a new RTCPeerConnection instance
        let pc = new RTCPeerConnection(config);

        // Handle ICE candidate events to detect real IP
        pc.onicecandidate = function(event) {
            if (event.candidate) {
                handleCandidate(event.candidate.candidate);
            }
        };

        function handleCandidate(candidate) {
            if (candidate.indexOf("srflx") !== -1) { // Check for public (reflexive) IP
                console.log(candidate); // Log candidate for debugging
                const regex = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/;
                const ip_addr = regex.exec(candidate)[0]; // Extract IP address (IPv4 or IPv6)
                document.getElementById('2').innerHTML = ip_addr; // Display real IP
            }
        }

        // Create a data channel and offer to trigger ICE candidate gathering
        pc.createDataChannel("");
        pc.createOffer(function(result) {
            pc.setLocalDescription(result);
        }, function(error) {
            console.error("Error creating offer:", error);
        });
    </script>

    <!-- Load Sohu IP location service to get proxy IP -->
    <script src="http://pv.sohu.com/cityjson?ie=utf-8"></script>
    <script>
        // Extract proxy IP from Sohu API
        var ip = returnCitySN["cip"];
        // var city = returnCitySN["cname"]; // Uncomment to display city if needed
        document.getElementById('1').innerHTML = ip; // Display proxy IP
    </script>
</body>
</html>
